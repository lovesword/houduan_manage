{extend name="common/editnosub" /}
{block name="content"}

<form class="layui-form" method="post" action="{:adminurl('savesend')}">
    <input type="hidden" name="id" value="{$info.id??''}">
    <div class="layui-form-item">
        <label class="layui-form-label">商品名称</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" readonly="readonly" class="layui-input" value="{$info.gname??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">用户uid</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{$info.user_id??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">用户名称</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{$info.username??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">订单号</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" readonly="readonly" class="layui-input" value="{$info.out_trade_no??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">微信单号</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{$info.transaction_id??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">订单金额(包含运费)</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{$info.order_amount??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">总兑换的积分</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{$info.total_integral??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">兑换数量</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{$info.total_num??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">运费</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" readonly="readonly" class="layui-input" value="{$info.distribution??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">配送方式</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" name="name" readonly="readonly" class="layui-input" value="{if condition="$info['sincetype'] eq 1" /}快递
            {elseif condition="$info['sincetype'] eq 2"/} 到店自提
            {/if}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">姓名</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{$info.name??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">手机</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{$info.phone??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">地址</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" readonly="readonly" class="layui-input" value="{$info.address??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">订单状态</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" name="order_status" readonly="readonly" class="layui-input" value="{switch name="info.order_status"}
            {case value="0"}未付款{/case}
            {case value="1"}待发货{/case}
            {case value="2"}待收货{/case}
            {case value="3"}已完成{/case}
            {default /}default
            {/switch}">

        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">下单时间</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{$info.dh_time??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">支付方式</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{if condition="$info['pay_type'] eq 1" /}微信支付
            {elseif condition="$info['pay_type'] eq 2"/} 零钱支付
            {/if}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">支付状态</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text"  readonly="readonly" class="layui-input" value="{$info.pay_status??''}">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">支付时间</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" readonly="readonly" class="layui-input" value="{$info.pay_time??''}">
        </div>
    </div>
    {if $info['sincetype']==1}
    <div class="layui-form-item">
        <label class="layui-form-label" style="color: red">*请填写快递公司</label>
        <div class="layui-input-block">
            <select name="express_delivery" id="express_delivery" class="select2" lay-ignore></select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label" style="color: red">*请填写快递单号</label>
        <div class="layui-input-block">
            <input autocomplete="off" type="text" name="express_orderformid" lay-verify="required" class="layui-input" value="{$info.express_orderformid??''}">
        </div>
    </div>
    {elseif $info['sincetype']==2}
    <div class="layui-form-item">
        <div class="layui-input-block">
        <h3 style="color: red">*请确认用户已到店取货</h3>
        </div></div>

    {/if}

    <div class="layui-form-item">
        <div class="layui-input-block">
            {if $info['sincetype']==1}
            <button class="layui-btn" lay-submit="">立即发货</button>
            {elseif $info['sincetype']==2}
            <button class="layui-btn" lay-submit="">确认取货</button>
            {/if}
            <button class="layui-btn layui-btn-primary" id="btnCancel">取消</button>
        </div>
    </div>
</form>

<script>
    //JavaScript代码区域
    layui.use(['element','form'], function(){
        var element = layui.element;
        var form = layui.form;

        // 新增界面、保存、取消事件
        form.on('submit', function(data){
            if(!$(data.elem).is('button')){
                return false;
            }
            var data = data.field;
            console.log(data);
            var url = "{:adminurl('savesend')}";
            $.post(url,data,function(res){
                if (typeof res == 'string'){
                    res = $.parseJSON(res);
                }
                if (res.code == 0) {
                    var index=parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                    parent.layer.msg('保存成功',{icon: 6,anim: 6});
                    parent.layui.table.reload('laytable',{});
                }else{
                    layer.msg(res.msg,{icon: 5,anim: 6});
                }
            });
            return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
        });
        $('#btnCancel').click(function(e){
            var index=parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        })
    })
    require(['select2'], function () {
        $('.select2').select2();
        var ret = [
            {"id":"中通","text":"中通"},
            {"id":"顺丰","text":"顺丰"},
            {"id":"圆通","text":"圆通"},
            {"id":"申通","text":"申通"},
            {"id":"韵达","text":"韵达"},
            {"id":"EMS","text":"EMS"},
            {"id":"邮政","text":"邮政"},
            {"id":"德邦","text":"德邦"},
            {"id":"天天","text":"天天"},
            {"id":"宅急送","text":"宅急送"},
            {"id":"优速","text":"优速"},
            {"id":"汇通","text":"汇通"},
            {"id":"速尔","text":"速尔"},
            {"id":"全峰","text":"全峰"},
        ];
        // ret.unshift({id: '', text: '请选择类型'});
        ret.map(function (obj) {
            obj.keywords += obj.text.toPinYin() + obj.text.toPinYin(true);
            return obj;
        });
        $('#express_delivery').select2({
            data: ret,
        })
    })
</script>

{/block}